<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LYRN Dashboard v6.1</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet" />

    <style>
        /* [ ... CORE VARIABLES ... ] */
        :root {
            --bg-core: #050505;
            --bg-panel: #0a0a0a;
            --brand-purple: #7c5cff;
            --brand-purple-dim: rgba(124, 92, 255, 0.1);
            --brand-purple-glow: rgba(124, 92, 255, 0.5);
            --text-head: #ffffff;
            --text-body: #b0b0b0;
            --text-dim: #666666;
            --border-color: #222222;
            --header-height: 32px;
            --dock-bg: rgba(10, 10, 10, 0.85);
            --dock-border: rgba(255, 255, 255, 0.1);
        }

        body[data-theme="light"] {
            --bg-core: #eef0f4;
            --bg-panel: #ffffff;
            --brand-purple: #6a4ce0;
            --brand-purple-dim: rgba(106, 76, 224, 0.1);
            --brand-purple-glow: rgba(106, 76, 224, 0.3);
            --text-head: #111111;
            --text-body: #333333;
            --text-dim: #555555;
            --border-color: #d1d5db;
            --dock-bg: rgba(255, 255, 255, 0.85);
            --dock-border: rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; }
        
        body.is-dragging-global { user-select: none; cursor: grabbing; }
        
        body {
            margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden;
            background-color: var(--bg-core);
            font-family: 'Inter', system-ui, sans-serif;
            color: var(--text-body);
            transition: background-color 0.5s ease;
            background-image:
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(124, 92, 255, 0.03) 10px, rgba(124, 92, 255, 0.03) 11px),
                radial-gradient(circle at 50% 0%, rgba(124, 92, 255, 0.15) 0%, transparent 60%);
            background-size: auto, 100% 100%;
            background-attachment: fixed;
        }

        /* --- SCROLLBAR THEME (Global) --- */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-core); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; border: 2px solid var(--bg-core); }
        ::-webkit-scrollbar-thumb:hover { background: var(--brand-purple); }

        /* [ ... WINDOW STYLES ... ] */
        #desktop-area { position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 1; }

        .lyrn-window {
            position: absolute;
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            display: flex; flex-direction: column;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            border-radius: 6px; overflow: hidden;
            width: 800px; height: 600px;
            min-width: 300px; min-height: 200px;
            transition: border-color 0.3s, box-shadow 0.2s; 
        }

        @media (max-width: 768px) {
            .lyrn-window {
                width: 95% !important; height: 80% !important;
                left: 2.5% !important; top: 5% !important;
            }
        }

        .lyrn-window.active {
            border-color: var(--brand-purple);
            box-shadow: 0 15px 50px rgba(0,0,0,0.6), 0 0 10px var(--brand-purple-dim);
            z-index: 100;
        }

        .window-header {
            height: var(--header-height);
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 12px; cursor: grab; user-select: none; flex-shrink: 0;
        }
        .window-header:active { cursor: grabbing; }

        .window-title {
            font-family: 'JetBrains Mono', monospace; font-size: 11px; text-transform: uppercase;
            letter-spacing: 0.1em; color: var(--text-dim); pointer-events: none;
        }
        .lyrn-window.active .window-title { color: var(--brand-purple); }

        .window-controls { display: flex; gap: 8px; }
        .win-btn {
            width: 12px; height: 12px; border-radius: 50%; border: 1px solid var(--border-color);
            cursor: pointer; transition: all 0.2s;
        }
        .win-btn.close:hover { background: #ff5f56; border-color: #ff5f56; }

        .window-content { flex: 1; position: relative; background: var(--bg-core); overflow: hidden; }
        iframe { width: 100%; height: 100%; border: none; display: block; }
        .iframe-shield { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; display: none; }
        .lyrn-window.is-dragging .iframe-shield, .lyrn-window.is-resizing .iframe-shield { display: block; }

        .resize-handle {
            position: absolute; bottom: 0; right: 0; width: 16px; height: 16px;
            cursor: nwse-resize; z-index: 20;
            background: linear-gradient(135deg, transparent 50%, var(--brand-purple) 50%); opacity: 0.5;
        }
        .resize-handle:hover { opacity: 1; }

        /* [ ... DOCK SYSTEM ... ] */
        
        #dock-container {
            position: fixed; z-index: 10000;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        }

        #dock-content {
            display: flex; gap: 8px; padding: 8px;
            background: var(--dock-bg); 
            backdrop-filter: blur(10px);
            border: 1px solid var(--dock-border);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }

        .dock-separator {
            width: 1px; height: 24px; background: var(--border-color); margin: 0 4px;
        }
        
        .dock-btn {
            width: 40px; height: 40px; border-radius: 8px; background: transparent;
            border: 1px solid transparent; color: var(--text-dim); display: flex;
            align-items: center; justify-content: center; font-size: 20px; padding: 0;
            cursor: pointer; transition: all 0.2s; position: relative;
        }
        .dock-btn:hover { background: var(--brand-purple-dim); color: var(--brand-purple); border-color: var(--brand-purple); transform: scale(1.1); }
        .dock-btn:active { transform: scale(0.95); }
        
        /* Tooltips */
        .dock-btn::after {
            content: attr(title);
            position: absolute; bottom: 120%; left: 50%; transform: translateX(-50%);
            background: var(--bg-panel); border: 1px solid var(--border-color);
            color: var(--text-head); font-size: 10px; padding: 4px 8px; border-radius: 4px;
            white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.2s;
            font-family: 'JetBrains Mono', monospace; z-index: 20;
        }
        .dock-btn:hover::after { opacity: 1; }

        /* Handle */
        #dock-handle {
            display: flex; align-items: center; justify-content: center;
            cursor: grab; background: var(--bg-panel); border: 1px solid var(--border-color);
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            opacity: 1; transition: opacity 0.2s;
        }
        #dock-handle:active { cursor: grabbing; }
        .handle-bar { background-color: #ffffff; border-radius: 2px; box-shadow: 0 0 6px var(--brand-purple); }

        /* --- DOCK MODES --- */

        /* 1. FLOATING MODES (Standard) */
        .dock-floating.dock-bottom {
            bottom: 30px; left: 50%; transform: translateX(-50%); flex-direction: column;
        }
        .dock-floating.dock-bottom #dock-content { border-radius: 16px; margin-bottom: 8px; flex-direction: row; }
        .dock-floating.dock-bottom #dock-handle { width: 60px; height: 12px; border-radius: 10px; margin-top: 5px; }
        .dock-floating.dock-bottom .handle-bar { width: 30px; height: 4px; }

        .dock-floating.dock-left {
            left: 20px; top: 50%; transform: translateY(-50%); flex-direction: row-reverse;
        }
        .dock-floating.dock-left #dock-content { border-radius: 16px; margin-right: 8px; flex-direction: column; }
        .dock-floating.dock-left #dock-handle { width: 12px; height: 60px; border-radius: 10px; margin-left: 5px; }
        .dock-floating.dock-left .handle-bar { width: 4px; height: 30px; }
        .dock-floating.dock-left .dock-separator { width: 24px; height: 1px; margin: 4px 0; }
        .dock-floating.dock-left .dock-btn::after { bottom: auto; left: 120%; top: 50%; transform: translateY(-50%); }

        /* 2. FIXED MODES (4-Way) */
        
        /* BOTTOM FIXED */
        .dock-fixed.dock-bottom {
            bottom: 20px; left: 50%; transform: translateX(-50%); width: auto; max-width: 90%;
        }
        .dock-fixed.dock-bottom #dock-content { border-radius: 24px; padding: 12px 20px; gap: 15px; flex-direction: row; }
        .dock-fixed.dock-bottom #dock-handle { display: none; }

        /* TOP FIXED */
        .dock-fixed.dock-top {
            top: 20px; left: 50%; transform: translateX(-50%); width: auto; max-width: 90%;
        }
        .dock-fixed.dock-top #dock-content { border-radius: 24px; padding: 12px 20px; gap: 15px; flex-direction: row; }
        .dock-fixed.dock-top #dock-handle { display: none; }
        .dock-fixed.dock-top .dock-btn::after { bottom: auto; top: 120%; }

        /* LEFT FIXED */
        .dock-fixed.dock-left {
            left: 20px; top: 50%; transform: translateY(-50%); height: auto; max-height: 90%;
        }
        .dock-fixed.dock-left #dock-content { border-radius: 24px; padding: 20px 12px; gap: 15px; flex-direction: column; }
        .dock-fixed.dock-left .dock-separator { width: 100%; height: 1px; }
        .dock-fixed.dock-left #dock-handle { display: none; }
        .dock-fixed.dock-left .dock-btn::after { bottom: auto; left: 130%; top: 50%; transform: translateY(-50%); }

        /* RIGHT FIXED */
        .dock-fixed.dock-right {
            right: 20px; top: 50%; transform: translateY(-50%); height: auto; max-height: 90%;
        }
        .dock-fixed.dock-right #dock-content { border-radius: 24px; padding: 20px 12px; gap: 15px; flex-direction: column; }
        .dock-fixed.dock-right .dock-separator { width: 100%; height: 1px; }
        .dock-fixed.dock-right #dock-handle { display: none; }
        .dock-fixed.dock-right .dock-btn::after { bottom: auto; right: 130%; left: auto; top: 50%; transform: translateY(-50%); }


        /* [ ... SETTINGS MENU ... ] */
        #settings-menu {
            position: fixed; background: var(--bg-panel); border: 1px solid var(--border-color);
            box-shadow: 0 10px 40px rgba(0,0,0,0.8); border-radius: 8px; padding: 15px;
            z-index: 10001; width: 220px; display: flex; flex-direction: column; gap: 8px;
            opacity: 0; pointer-events: none; transition: opacity 0.2s;
        }
        #settings-menu.visible { opacity: 1; pointer-events: auto; }
        .menu-header {
             font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--brand-purple); 
             margin-bottom: 5px; text-transform: uppercase; border-bottom: 1px solid var(--border-color); padding-bottom: 5px;
        }
        .menu-item {
            font-family: 'Inter', sans-serif; font-size: 12px; color: var(--text-body);
            padding: 8px 10px; border-radius: 4px; cursor: pointer; display: flex;
            justify-content: space-between; align-items: center; background: rgba(255,255,255,0.02);
        }
        .menu-item:hover { background: var(--brand-purple-dim); color: var(--text-head); }
        .menu-value { font-family: 'JetBrains Mono'; color: var(--text-dim); font-size: 10px; }

    </style>
</head>
<body data-theme="dark">

    <div id="desktop-area"></div>

    <div id="dock-container" class="dock-floating dock-bottom">
        <div id="dock-content">
            </div>
        <div id="dock-handle"><div class="handle-bar"></div></div>
    </div>

    <div id="settings-menu">
        <div class="menu-header">System</div>
        <div class="menu-item" onclick="toggleTheme()">
            <span>Theme</span>
            <span id="theme-label" class="menu-value">DARK</span>
        </div>
        
        <div class="menu-header" style="margin-top: 10px;">Dock Settings</div>
        <div class="menu-item" onclick="toggleDockMode()">
            <span>Mode</span>
            <span id="dock-mode-label" class="menu-value">FLOATING</span>
        </div>
        <div class="menu-item" onclick="cycleDockPosition()">
            <span>Position</span>
            <span id="dock-pos-label" class="menu-value">BOTTOM</span>
        </div>

        <div class="menu-header" style="margin-top: 10px;">Window</div>
        <div class="menu-item" onclick="resetLayout()"><span>Reset Desktop</span></div>
    </div>

    <script>
        /* =========================================
           1. MODULE REGISTRY (Cleaned)
           ========================================= */
        const MODULE_REGISTRY = [
            { file: 'Snapshot Builder.html', name: 'Snapshot Builder', icon: 'ðŸ› ï¸' }
            // Add new modules here as { file: '...', name: '...', icon: '...' }
        ];

        /* =========================================
           2. SYSTEM STATE
           ========================================= */
        let highestZ = 100;
        let windows = [];
        
        // Persistent Settings
        const config = {
            theme: localStorage.getItem('lyrn-theme') || 'dark',
            dockMode: localStorage.getItem('lyrn-dock-mode') || 'floating', // 'floating' or 'fixed'
            dockPos: localStorage.getItem('lyrn-dock-pos') || 'bottom' // 'bottom', 'left', 'top', 'right'
        };

        document.addEventListener('DOMContentLoaded', () => {
            applyTheme(config.theme);
            initDockSystem();
            updateDockClasses();
        });

        /* =========================================
           3. DOCK LOGIC
           ========================================= */
        function initDockSystem() {
            const dockContent = document.getElementById('dock-content');
            dockContent.innerHTML = ''; 

            // 1. Generate Module Icons
            MODULE_REGISTRY.forEach(mod => {
                const btn = document.createElement('button');
                btn.className = 'dock-btn';
                btn.title = mod.name;
                btn.innerHTML = mod.icon || 'ðŸ“¦';
                const path = `modules/${mod.file}`;
                btn.onclick = () => openModule(path, mod.name);
                dockContent.appendChild(btn);
            });

            // 2. Add Separator (if modules exist)
            if(MODULE_REGISTRY.length > 0) {
                const sep = document.createElement('div');
                sep.className = 'dock-separator';
                dockContent.appendChild(sep);
            }

            // 3. Add System Icons
            const settingsBtn = document.createElement('button');
            settingsBtn.className = 'dock-btn';
            settingsBtn.title = 'Settings';
            settingsBtn.id = 'settings-btn';
            settingsBtn.innerHTML = 'âš™ï¸';
            dockContent.appendChild(settingsBtn);

            if (window.self !== window.top) {
                const exitBtn = document.createElement('button');
                exitBtn.className = 'dock-btn';
                exitBtn.title = 'Exit System';
                exitBtn.innerHTML = 'âœ•';
                exitBtn.style.color = '#ff5f56';
                exitBtn.onclick = () => window.parent.postMessage({ type: 'CLOSE_DASHBOARD' }, '*');
                dockContent.appendChild(exitBtn);
            }

            const handle = document.getElementById('dock-handle');
            setupDockDrag(handle);
            setupSettingsMenu(settingsBtn);
        }

        function setupDockDrag(handle) {
            const dock = document.getElementById('dock-container');
            let isDragging = false;
            let startX, startY, initL, initT;

            const start = (e) => {
                if(config.dockMode === 'fixed') return;
                isDragging = true;
                dock.classList.add('is-dragging');
                document.body.classList.add('is-dragging-global');
                
                const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
                startX = clientX; startY = clientY;
                
                const rect = dock.getBoundingClientRect();
                initL = rect.left; initT = rect.top;
                
                // Unset specialized positioning so drag works freely
                dock.style.bottom = 'auto'; dock.style.right = 'auto'; 
                dock.style.transform = 'none';
                dock.style.left = initL + 'px'; dock.style.top = initT + 'px';
                
                document.addEventListener('mousemove', move); document.addEventListener('mouseup', end);
                document.addEventListener('touchmove', move, {passive:false}); document.addEventListener('touchend', end);
            };

            const move = (e) => {
                if(!isDragging) return;
                e.preventDefault();
                const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
                dock.style.left = (initL + (clientX - startX)) + 'px';
                dock.style.top = (initT + (clientY - startY)) + 'px';
            };

            const end = () => {
                isDragging = false; dock.classList.remove('is-dragging');
                document.body.classList.remove('is-dragging-global');
                document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', end);
                document.removeEventListener('touchmove', move); document.removeEventListener('touchend', end);
            };
            handle.addEventListener('mousedown', start); handle.addEventListener('touchstart', start);
        }

        /* =========================================
           4. SETTINGS HANDLERS
           ========================================= */
        function setupSettingsMenu(btn) {
            const menu = document.getElementById('settings-menu');
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                menu.classList.toggle('visible');
                if(menu.classList.contains('visible')) positionSettingsMenu(btn, menu);
            });
            window.addEventListener('click', (e) => {
                if(!menu.contains(e.target) && e.target !== btn) menu.classList.remove('visible');
            });
        }

        function positionSettingsMenu(btn, menu) {
            const rect = btn.getBoundingClientRect();
            // Default: place above or below depending on space
            let left = rect.left; 
            let top = rect.top - menu.offsetHeight - 10;
            if(left + 220 > window.innerWidth) left = window.innerWidth - 230;
            if(top < 10) top = rect.bottom + 10;
            menu.style.left = left + 'px'; menu.style.top = top + 'px';
        }

        function updateDockClasses() {
            const dock = document.getElementById('dock-container');
            dock.className = ''; // Clear all
            
            // Re-apply state classes
            dock.classList.add(`dock-${config.dockMode}`);
            dock.classList.add(`dock-${config.dockPos}`);
            
            // If in floating mode, we treat 'top'/'bottom' as horizontal, 'left'/'right' as vertical logic (mostly)
            // But to simplify floating logic, we map top/bottom -> bottom style, left/right -> left style
            if(config.dockMode === 'floating') {
                if(config.dockPos === 'top' || config.dockPos === 'bottom') dock.classList.add('dock-bottom'); // reuse class
                if(config.dockPos === 'left' || config.dockPos === 'right') dock.classList.add('dock-left'); // reuse class
            }

            document.getElementById('dock-mode-label').innerText = config.dockMode.toUpperCase();
            document.getElementById('dock-pos-label').innerText = config.dockPos.toUpperCase();

            // Clear inline styles to allow CSS positioning to take over
            if(config.dockMode === 'fixed') {
                dock.style.top = ''; dock.style.left = ''; dock.style.transform = ''; dock.style.bottom = ''; dock.style.right = '';
            }
        }

        function toggleDockMode() {
            config.dockMode = config.dockMode === 'floating' ? 'fixed' : 'floating';
            localStorage.setItem('lyrn-dock-mode', config.dockMode);
            updateDockClasses();
        }

        function cycleDockPosition() {
            // Cycle: BOTTOM -> LEFT -> TOP -> RIGHT
            const order = ['bottom', 'left', 'top', 'right'];
            const idx = order.indexOf(config.dockPos);
            const next = order[(idx + 1) % order.length];
            config.dockPos = next;
            localStorage.setItem('lyrn-dock-pos', config.dockPos);
            updateDockClasses();
        }

        function toggleTheme() {
            const next = config.theme === 'dark' ? 'light' : 'dark';
            applyTheme(next);
        }

        function applyTheme(t) {
            config.theme = t;
            document.body.setAttribute('data-theme', t);
            localStorage.setItem('lyrn-theme', t);
            document.getElementById('theme-label').innerText = t.toUpperCase();
            document.querySelectorAll('iframe').forEach(iframe => {
                iframe.contentWindow.postMessage({ type: 'THEME_CHANGE', theme: t }, '*');
            });
        }

        /* =========================================
           5. WINDOW MANAGER
           ========================================= */
        function openModule(url, title) {
            createWindow(url, title);
        }

        function createWindow(url, title) {
            const id = 'win_' + Date.now();
            const desktop = document.getElementById('desktop-area');
            const isMobile = window.innerWidth < 768;
            
            let styleStr = '';
            if (isMobile) {
                styleStr = 'left: 2.5%; top: 5%; width: 95%; height: 85%;';
            } else {
                const cascade = (windows.length * 30) % 150;
                const startX = Math.max(50, (window.innerWidth - 800)/2 + cascade);
                const startY = Math.max(50, (window.innerHeight - 600)/2 + cascade);
                styleStr = `left: ${startX}px; top: ${startY}px; width: 800px; height: 600px;`;
            }

            const winEl = document.createElement('div');
            winEl.className = 'lyrn-window active';
            winEl.id = id;
            winEl.style.cssText = styleStr;
            winEl.style.zIndex = ++highestZ;

            winEl.innerHTML = `
                <div class="window-header">
                    <span class="window-title">${title}</span>
                    <div class="window-controls">
                        <div class="win-btn close" onclick="closeWindow('${id}')"></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="iframe-shield"></div>
                    <iframe name="${id}_frame" src="${url}"></iframe>
                </div>
                <div class="resize-handle"></div>
            `;

            desktop.appendChild(winEl);
            windows.push(id);
            
            const iframe = winEl.querySelector('iframe');
            iframe.onload = () => {
                iframe.contentWindow.postMessage({ type: 'THEME_CHANGE', theme: config.theme }, '*');
            };

            winEl.addEventListener('mousedown', () => activateWindow(winEl));
            winEl.addEventListener('touchstart', () => activateWindow(winEl));

            setupWindowDrag(winEl.querySelector('.window-header'), winEl);
            setupWindowResize(winEl.querySelector('.resize-handle'), winEl);
        }

        function closeWindow(id) {
            const win = document.getElementById(id);
            if(win) {
                win.remove();
                windows = windows.filter(w => w !== id);
            }
        }

        function activateWindow(el) {
            el.classList.add('active');
            el.style.zIndex = ++highestZ;
            document.querySelectorAll('.lyrn-window').forEach(w => {
                if(w !== el) w.classList.remove('active');
            });
        }

        function resetLayout() {
            windows.forEach(closeWindow);
            config.dockMode = 'floating';
            config.dockPos = 'bottom';
            updateDockClasses();
        }

        // --- Window Drag/Resize Utils ---
        function setupWindowDrag(handle, element) {
            let isDragging = false;
            let startX, startY, initL, initT;
            const start = (e) => {
                if(e.target.classList.contains('win-btn')) return;
                isDragging = true;
                activateWindow(element);
                element.classList.add('is-dragging');
                document.body.classList.add('is-dragging-global');
                const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
                startX = clientX; startY = clientY;
                initL = element.offsetLeft; initT = element.offsetTop;
                document.addEventListener('mousemove', move); document.addEventListener('mouseup', end);
                document.addEventListener('touchmove', move, {passive:false}); document.addEventListener('touchend', end);
            };
            const move = (e) => {
                if(!isDragging) return;
                e.preventDefault();
                const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
                element.style.left = (initL + (clientX - startX)) + 'px';
                element.style.top = (initT + (clientY - startY)) + 'px';
            };
            const end = () => {
                isDragging = false; element.classList.remove('is-dragging');
                document.body.classList.remove('is-dragging-global');
                document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', end);
                document.removeEventListener('touchmove', move); document.removeEventListener('touchend', end);
            };
            handle.addEventListener('mousedown', start); handle.addEventListener('touchstart', start);
        }

        function setupWindowResize(handle, element) {
            let isResizing = false;
            let startX, startY, startW, startH;
            const start = (e) => {
                isResizing = true;
                activateWindow(element);
                element.classList.add('is-resizing');
                document.body.classList.add('is-dragging-global');
                e.stopPropagation();
                const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
                startX = clientX; startY = clientY;
                startW = element.offsetWidth; startH = element.offsetHeight;
                document.addEventListener('mousemove', move); document.addEventListener('mouseup', end);
                document.addEventListener('touchmove', move, {passive:false}); document.addEventListener('touchend', end);
            };
            const move = (e) => {
                if(!isResizing) return;
                e.preventDefault();
                const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
                element.style.width = Math.max(300, startW + (clientX - startX)) + 'px';
                element.style.height = Math.max(200, startH + (clientY - startY)) + 'px';
            };
            const end = () => {
                isResizing = false; element.classList.remove('is-resizing');
                document.body.classList.remove('is-dragging-global');
                document.removeEventListener('mousemove', move); document.removeEventListener('mouseup', end);
                document.removeEventListener('touchmove', move); document.removeEventListener('touchend', end);
            };
            handle.addEventListener('mousedown', start); handle.addEventListener('touchstart', start);
        }
    </script>
</body>
</html>