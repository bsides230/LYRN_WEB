<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LYRN – Snapshot Builder Demo</title>
  <!-- Use the existing site fonts and CSS -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <!-- Custom styles for the demo UI -->
  <style>
    /* Layout for the builder demo */
    .builder-container {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 20px;
      margin-top: 20px;
    }
    .component-list {
      border: 1px solid var(--border-color);
      padding: 10px;
      background: var(--bg-panel);
      max-height: 400px;
      overflow-y: auto;
    }
    .component-item {
      padding: 6px 8px;
      border: 1px solid var(--border-color);
      margin-bottom: 6px;
      cursor: pointer;
    }
    .component-item.active {
      background: var(--bg-accent);
      color: var(--text-high);
    }
    .editor {
      border: 1px solid var(--border-color);
      padding: 10px;
      background: var(--bg-panel);
    }
    .editor input,
    .editor textarea {
      width: 100%;
      margin-bottom: 10px;
      padding: 6px;
      color: var(--text-body);
      background: var(--bg-input);
      border: 1px solid var(--border-color);
    }
    .button-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    #promptOutput {
      border: 1px solid var(--border-color);
      padding: 10px;
      background: var(--bg-panel);
      white-space: pre-wrap;
      min-height: 120px;
    }
  </style>
</head>
<body>
  <!-- Theme toggle button (shared across the site) -->
  <button id="themeButton" class="theme-button">LIGHT MODE</button>
  <div class="page-container">
    <!-- Header with logo and description -->
    <header>
      <div class="header-left">
        <a href="index.html"><img src="assets/logo.png" alt="LYRN Logo" style="height: 80px; width: auto; flex-shrink: 0;" /></a>
        <div>
          <div class="meta-label">LYRN · SNAPSHOT DEMO</div>
          <h1 class="hero-title">Snapshot Builder Demo</h1>
          <p style="max-width: 90%;">This page provides a simplified demonstration of the LYRN snapshot prompt builder. You can add and reorder components, edit their content, and generate a master prompt locally.</p>
        </div>
      </div>
      <!-- Navigation menu including link back to this demo -->
      <nav class="main-nav">
        <a href="index.html" class="nav-link">Home</a>
        <details class="details-dropdown">
          <summary id="nav-architecture" class="nav-link">Architecture</summary>
          <div class="dropdown-menu">
            <a href="embodied.html" class="nav-link">Embodied</a>
            <a href="memory.html" class="nav-link">Memory</a>
            <a href="reflection.html" class="nav-link">Reflection</a>
            <a href="topic.html" class="nav-link">Topic Index</a>
          </div>
        </details>
        <a href="industry.html" class="nav-link">Industry</a>
        <a href="kiosks.html" class="nav-link">Kiosks</a>
        <a href="security.html" class="nav-link">Security</a>
        <a href="space.html" class="nav-link">Space</a>
        <a href="snapshot_demo.html" class="nav-link">Snapshot Demo</a>
      </nav>
    </header>

    <!-- Builder interface -->
    <div class="section-divider">01 // Build a Snapshot</div>
    <div class="builder-container">
      <!-- Left panel: list of components -->
      <div class="component-list" id="componentList"></div>
      <!-- Right panel: editor -->
      <div class="editor" id="editorPanel">
        <label for="compName">Component Name:</label>
        <input type="text" id="compName" placeholder="Enter a name" />
        <label for="compContent">Content:</label>
        <textarea rows="8" id="compContent" placeholder="Enter component content"></textarea>
        <div class="button-row" style="margin-top: 10px;">
          <button id="saveComponent" class="btn-primary">Save</button>
          <button id="deleteComponent">Delete</button>
        </div>
      </div>
    </div>
    <!-- Global actions -->
    <div class="button-row" style="margin-top: 20px;">
      <button id="addComponent">Add Component</button>
      <button id="buildPrompt" class="btn-primary">Build Master Prompt</button>
    </div>
    <!-- Output area for the master prompt -->
    <div id="promptOutput" style="margin-top: 20px;"></div>
    <div class="button-row" style="margin-top: 10px;">
      <button id="copyPrompt">Copy to Clipboard</button>
      <button id="clearComponents">Clear All</button>
    </div>

    <!-- Footer with theme switch -->
    <footer>
      <span>LYRN SYSTEMS // SNAPSHOT DEMO</span>
      <div class="footer-right">
        <span>SNAPSHOT DEMO // EOF</span>
        <label class="theme-toggle-inline">THEME
          <span class="theme-switch">
            <input type="checkbox" id="themeToggle" />
            <span class="slider"></span>
          </span>
        </label>
      </div>
    </footer>
  </div>
  <!-- Script implementing the demo logic -->
  <script>
    // Immediately invoked function to avoid polluting global scope
    (function() {
      let components = [];
      let selectedIndex = -1;
      const listEl = document.getElementById('componentList');
      const nameInput = document.getElementById('compName');
      const contentInput = document.getElementById('compContent');
      const outputEl = document.getElementById('promptOutput');

      // Load from localStorage or seed with some defaults
      function loadState() {
        try {
          const stored = localStorage.getItem('snapshotDemoComponents');
          components = stored ? JSON.parse(stored) : [];
        } catch(e) {
          components = [];
        }
        if (components.length === 0) {
          components = [
            { name: 'Observation', content: 'Describe what the agent senses.' },
            { name: 'Memory Retrieval', content: 'Summarize relevant memories.' },
            { name: 'Action Plan', content: 'Outline the next steps.' },
          ];
        }
      }

      function saveState() {
        localStorage.setItem('snapshotDemoComponents', JSON.stringify(components));
      }

      function renderList() {
        listEl.innerHTML = '';
        components.forEach((comp, idx) => {
          const item = document.createElement('div');
          item.className = 'component-item' + (idx === selectedIndex ? ' active' : '');
          item.textContent = comp.name;
          item.onclick = () => selectComponent(idx);
          listEl.appendChild(item);
        });
      }

      function selectComponent(index) {
        selectedIndex = index;
        const comp = components[index];
        nameInput.value = comp.name;
        contentInput.value = comp.content;
        renderList();
      }

      function addComponent() {
        const newComp = { name: 'New Component', content: '' };
        components.push(newComp);
        selectedIndex = components.length - 1;
        saveState();
        renderList();
        selectComponent(selectedIndex);
      }

      function saveComponent() {
        if (selectedIndex >= 0) {
          components[selectedIndex].name = nameInput.value;
          components[selectedIndex].content = contentInput.value;
          saveState();
          renderList();
        }
      }

      function deleteComponent() {
        if (selectedIndex >= 0) {
          components.splice(selectedIndex, 1);
          selectedIndex = -1;
          saveState();
          nameInput.value = '';
          contentInput.value = '';
          renderList();
        }
      }

      function buildPrompt() {
        const lines = components.map(c => {
          const header = c.name ? '### ' + c.name : '';
          const body = c.content ? c.content.trim() : '';
          return header + '\n' + body;
        });
        outputEl.textContent = lines.join('\n\n');
      }

      function copyPrompt() {
        navigator.clipboard.writeText(outputEl.textContent || '').then(() => {
          alert('Prompt copied to clipboard!');
        });
      }

      function clearAll() {
        if (confirm('Clear all components?')) {
          components = [];
          selectedIndex = -1;
          saveState();
          nameInput.value = '';
          contentInput.value = '';
          outputEl.textContent = '';
          renderList();
        }
      }

      // Event bindings
      document.getElementById('addComponent').onclick = addComponent;
      document.getElementById('saveComponent').onclick = saveComponent;
      document.getElementById('deleteComponent').onclick = deleteComponent;
      document.getElementById('buildPrompt').onclick = buildPrompt;
      document.getElementById('copyPrompt').onclick = copyPrompt;
      document.getElementById('clearComponents').onclick = clearAll;

      // Initialize
      loadState();
      saveState();
      renderList();
    })();
  </script>
  <!-- Shared script for theme and nav interactions -->
  <script src="script.js"></script>
</body>
</html>